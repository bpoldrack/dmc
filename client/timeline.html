<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="NeuroDebian Software Survey" />
  <meta name="author" content="NeuroDebian" />

  <title>NeuroDebian Software Survey</title>

  <link rel="stylesheet" href="css/bootstrap.3.3.5.min.css" />
  <link rel="stylesheet" href="css/timeline.css" />

  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>
<header>
  <div class="jumbotron text-center" id="overview">
    <div class="container">
      <h1><a href="/">NeuroDebian Software Survey</a></h1>
    </div>
  </div>
</header>

<main class="container">
  <div class="page-header">
    <h1 id="timeline">Timeline</h1>
  </div>
  <form id="survey" data-toggle="validator">
  <ul class="timeline">
    <li id="employer-group">
      <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
      <div class="timeline-panel form-group">
        <div class="timeline-heading">
          <label for="employer" class="timeline-title control-label">Employer</label>
          <p><small id="employer-help" class="text-muted help-block">Select what fits best</small></p>
        </div>
        <div class="timeline-body">
          <select id="employer" aria-describedby="employer-help"
                  class="form-control"
                  required>
            <option value="" disabled selected hidden>— Select —</option>
            <option>Public University</option>
            <option>Private University</option>
            <option>Research Institution</option>
            <option>Company</option>
          </select>
          <div class="help-block with-errors"></div>
        </div>
      </div>
    </li>
    <li id="personal_device-group" class="timeline-inverted" hidden>
      <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
      <div class="timeline-panel form-group">
        <div class="timeline-heading">
          <label for="personal_device" class="timeline-title control-label">Research/Work Device</label>
          <p><small id="personal_device-help" class="text-muted help-block">Which type of device is "yours" at work to use daily for research-related tasks?</small></p>
        </div>
        <div class="timeline-body">
          <select id="personal_device" aria-describedby="personal_device-help"
                  class="form-control"
                  required>
            <option value="" disabled selected hidden>— Select —</option>
            <option>Phone/Tablet</option>
            <option>Laptop</option>
            <option>Desktop</option>
            <option>High-performance Workstation</option>
          </select>
          <div class="help-block with-errors"></div>
        </div>
      </div>
    </li>
    <li id="personal_OS-group" hidden>
      <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
      <div class="timeline-panel form-group">
        <div class="timeline-heading">
          <label for="personal_OS" class="timeline-title control-label">OS</label>
          <p><small id="personal_OS-help" class="text-muted help-block">What OS does the above device run?</small></p>
        </div>
        <div class="timeline-body">
          <select id="personal_OS" aria-describedby="personal_OS-help"
                  class="form-control"
                  required>
            <option value="" disabled selected hidden>— Select —</option>
            <option>Linux</option>
            <option>OS X</option>
            <option>Windows</option>
            <option>Other</option>
          </select>
          <div class="help-block with-errors"></div>
        </div>
      </div>
    </li>
    <li id="personal_OS_linux-group" data-next="#maintainer-group" hidden>
      <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
      <div class="timeline-panel form-group">
        <div class="timeline-heading">
          <label for="personal_OS_linux" class="timeline-title control-label">Linux Distro</label>
          <p><small id="personal_OS_linux-help" class="text-muted help-block"></small>It's just like choosing your favorite ice cream — riddled with political implications.</p>
        </div>
        <div class="timeline-body">
          <select id="personal_OS_linux_linux" aria-describedby="personal_OS_linux_linux-help"
                  class="form-control"
                  required>
            <option value="" disabled selected hidden>— Select —</option>
            <option>Debian</option>
            <option>Ubuntu/Mint</option>
            <option>RedHat/CentOS/Scientific Linux</option>
            <option>Fedora</option>
            <option>Arch</option>
            <option>Other</option>
            <option>Don't know</option>
          </select>
          <div class="help-block with-errors"></div>
        </div>
      </div>
    </li>
    <li id="personal_OS_other-group" data-next="#maintainer-group" hidden>
      <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
      <div class="timeline-panel form-group">
        <div class="timeline-heading">
          <label for="personal_OS_other" class="timeline-title control-label">Other OS</label>
          <p><small id="personal_OS_other-help" class="text-muted help-block"></small><em>Alright.</em> You get righteous-cool-points; we love non-conformists.</p>
        </div>
        <div class="timeline-body">
          <input id="personal_OS_other" aria-describedby="personal_OS_other-help"
                 class="form-control"
                 type="text" required>
          <div class="help-block with-errors"></div>
        </div>
      </div>
    </li>
    <li id="maintainer-group" class="timeline-inverted" hidden>
      <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
      <div class="timeline-panel form-group">
        <div class="timeline-heading">
          <label for="maintainer" class="timeline-title control-label">Maintainer</label>
          <p><small id="maintainer-help" class="text-muted help-block"></small>Are you the person primarily responsible for maintaining this device?</p>
        </div>
        <div class="timeline-body">
          <select id="maintainer" aria-describedby="maintainer-help"
                  class="form-control"
                  required>
            <option value="" disabled selected hidden>— Select —</option>
            <option>Yes</option>
            <option>No</option>
          </select>
          <div class="help-block with-errors"></div>
        </div>
      </div>
    </li>
    <li id="hours-group" class="timeline-inverted" hidden>
      <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
      <div class="timeline-panel form-group">
        <div class="timeline-heading">
          <label for="hours" class="timeline-title control-label">Hours/month of Toil</label>
          <p><small id="hours-help" class="text-muted help-block"></small>How many hours per month do you personally spend maintaining this device?</p>
        </div>
        <div class="timeline-body">
          <input id="hours" aria-describedby="hours-help"
                 class="form-control"
                 type="number" min="0" step="1" required>
          <div class="help-block with-errors"></div>
        </div>
      </div>
    </li>
  </ul>
</form>
</main>
<footer id="site-footer">
  <div class="container">
    <p class="text-center text-muted"><small>
      © NeuroDebian 2015 &nbsp;&bull;&nbsp; Code Freely available on GitHub
    </small></p>
  </div>
</footer>

<!-- javascript -->
<script src="js/jquery-1.11.3.min.js"></script>
<script src="js/bootstrap.3.3.5.min.js"></script>
<script src="js/validator.0.9.0.min.js"></script>

<script>
$(document).ready(function() {
  // Allow multi-select without using ctrl
  $("select[multiple]").mousedown(function(e){
      e.preventDefault();
      e.target.selected = !e.target.selected; // invert selected state
      $(this).focus();
  }).mousemove(function(e){ e.preventDefault() }); // prevents bug where all are deselected when both clicking and moving

  // Submit form as JSON
  $("#survey").submit(function() {
    var val = this.getValue();
    $.ajax({
      type: "POST",
      contentType: 'application/json',
      url: "http://localhost:8080/submit",
      data: JSON.stringify(val),
      success: function(data) {
        alert(data);
      },
      error: function(xhr, ajaxOptions, thrownError) {
        alert(xhr.status);
        alert(ajaxOptions);
        alert(thrownError);
      }
    });
    return false; // don't actually submit the form
  });

 /*
  *  Field dependencies
  */
  $("#personal_OS").change(function() {
    var $this = $(this);
    var $parent_li = $this.parents('li');

    if ($this.val() == 'Linux') {
      $("#personal_OS_other-group").hide("slow");
      $parent_li.attr('data-next', '#personal_OS_linux-group');
    } else if ($this.val() == 'Other') {
      $("#personal_OS_linux-group").hide("slow");
      $parent_li.attr('data-next', '#personal_OS_other-group');
    } else {
      $("#personal_OS_linux-group").hide("slow");
      $("#personal_OS_other-group").hide("slow");
      $parent_li.attr('data-next', '#maintainer-group');
    }
  });

 /*
  *  Navigation
  *  All inputs, upon completion/validation, will show/scroll-to the next question
  */
  $("select, input").each(function () {
    var $this = $(this);
    $this.change(function (e) {
      // TODO: check validity
      var $root = $('html, body');
      var $parent_li = $this.parents('li');
      var data_next = $parent_li.attr('data-next');
      var $next_q;

      // if there's no next-question explicitly set, then just go to next in DOM
      if (data_next == undefined) {
        $next_q = $parent_li.next();
      } else {
        $next_q = $(data_next);
      }

      $next_q.fadeIn(2000);
      $root.animate({ scrollTop: $next_q.offset().top }, 1500);
    });
  });
});
</script>
</body>
</html>

